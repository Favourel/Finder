{% extends 'market/base.html' %}
{% load static %}
{% load humanize %}
{% load crispy_forms_tags %}
{% block title %}{{ vendor }}{% endblock %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

<div class="container">
    <div class="row gx-3">
        <div class="col-lg-3 phone_size">
            <div class="sticky-top" style="top: 80px">
                <div class="card border-0">
                    <div align="center" class="customer-profile">
                        <br>
                        <img width="120" height="120" background="#fff" color="#fff"
                             class="rounded-circle customer-image " src="{{ vendor.user.image.url }}">

                        <h5>
                            {{ vendor }}
                            {% if vendor.is_verified %}
                            <img width="20px" height="20px" class="mb-1"
                                 src="{% static 'images/verify.png' %}" alt="">
                            {% endif %}
                        </h5>
                        <p>{{ vendor.about }}</p>
                    </div>
                    <hr>
                    <div class="d-block">
                        <b>{{ vendor.user.following.count }} </b> Following |
                        <b class="_result_following"> {{ vendor.user.follower.count }} </b> Followers
                    </div>
                    <br>
                    <div class="row gx-3">
                        <div class="col">
                            {% if request.user == vendor.user %}
                            <a class="btn-lg-block btn text-light"
                               data-target="#updateUserModal" data-toggle="modal">Edit
                                profile
                            </a>
                            {% endif %}
                        </div>
                        <div class="col">
                            {% if request.user == vendor.user %}
                            <a class="btn-lg-block btn text-light" href="{% url 'vendor' request.user %}">
                                Visit Store
                            </a>
                            {% endif %}
                        </div>
                    </div>

                    <hr>
                    <p>
                        <img class="mr-2" src="https://img.icons8.com/ios-filled/20/000000/location-update--v2.png"/>
                        {{ vendor.location }}
                    </p>
                    <div class="d-md-block">
                        <a href="tel:{{ vendor.phone_number }}"
                           class="text-decoration-none category-link">
                            <p class="btn-call" onclick="off()">
                                <svg width="1em" height="1em" viewBox="0 0 16 16"
                                     class="bi mr-2 bi-telephone-outbound-fill"
                                     fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                          d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511zM11 .5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V1.707l-4.146 4.147a.5.5 0 0 1-.708-.708L14.293 1H11.5a.5.5 0 0 1-.5-.5z"/>
                                </svg>
                                {{vendor.phone_number }}
                            </p>
                        </a>
                        <style>
                            .category-link {color: #000;}
                            .category-link:hover{
                                color: #db3717;
                                }
                        </style>
                    </div>
                    <p>
                        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor"
                             class="bi bi-calendar3 mr-2" viewBox="0 0 16 16">
                            <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857V3.857z"/>
                            <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                        </svg>
                        Joined {{ vendor.date_joined|time }} &bull; {{ vendor.date_joined|date }}
                    </p>
                    <div class="flex mb-2">
                        <a href="{{ vendor.twitter_url }}">
                            <img src="https://img.icons8.com/color/40/000000/twitter-squared.png"/>
                        </a>
                        <a href="{{ vendor.instagram_url }}">
                            <img src="https://img.icons8.com/fluent/40/000000/instagram-new.png"/>
                        </a><br>
                    </div>

                    {% if request.user == vendor.user %}
                    {% if request.user.vendor %}
                    <a href="{% url 'create' %}" class="btn ">
                        Create Gig
                    </a>
                    {% else %}
                    <a href="{% url 'create_store' %}" class="btn ">
                        Create Gig
                    </a>
                    {% endif %}
                    {% endif %}
                    <b class="websocket"></b>
                </div>
                <br>
            </div>
        </div>
        <br>
        <div class="col-lg-9 col-md-9 mt-2">
            <br>
            <h4 class="mb-4">
                {% if 0 >= now %}
                    Good morning,
                {% elif now < 11.1 %}
                    Good morning,
                {% elif 12 >= now  %}
                    Good afternoon,
                {% elif now < 15.1 %}
                    Good afternoon,
                {% elif 16 >= now %}
                    Good evening,
                {% elif now < 19.1 %}
                    Good evening,
                {% elif 20 >= now %}
                    Good night,
                {% elif now < 23.1 %}
                    Good night,
                {% endif %}
                {{ request.user.vendor }}ðŸ˜‰!
            </h4>
            {% if DOW_CHOICES|length >= 2 %}
            <div class="mt-2 box-element text-light mb-4 bg-gradient rounded">
                <style>
                .bg-gradient {
                    background-imae: -o-linear-gradient(135deg,#014ba7,#0183d0);
                    background-imag: linear-gradient(-45deg,#014ba7,#0183d0);
                    background-color: #152e4d;
                    background-position: center;
                    font-color: white;
                    text-color: '#fff';
                }






                </style>
                <h6 style="margin-bottom: .5rem;
                font-family: vremenagrotesk,sans-serif;
                font-weight: 900;
                line-height: 1.5;color: #fff">Product Sales</h6>
                <hr>
                <canvas class="my-2 w-100 p-2 rounded" id="pie-chart" width="900" height="250"
                        style="font-color: white;text-color: #fff;">
                </canvas>

            </div>
            {% endif %}

            <div class="row mt-1">
                <div class="col-lg-3 mb-2">
                    <div class="box-element p-3"
                         style="background-image:url('{% static 'images/corner-1.png' %}');background-position: right; border-top-right-radius: .375rem;">

                        <h6  class="text-secondary">Total Products</h6>
                        <div class="order-row">
                            <h4 class="text-truncate" id="product-count" style="color: #f5803e!important;font-size: calc(1.2625rem + .15vw);">
                                {% if request.user.vendor %}
                                {{ products.count|intword }}
                                {% else %}
                                0
                                {% endif %}
                            </h4>
                            <svg style="color: #f5803e!important;" xmlns="http://www.w3.org/2000/svg" width="30px"
                                 height="30px" fill="currentColor"
                                 class="bi bi-box-seam ml-auto mt-1" viewBox="0 0 16 16">
                                <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2l-2.218-.887zm3.564 1.426L5.596 5 8 5.961 14.154 3.5l-2.404-.961zm3.25 1.7l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
                            </svg>
<!--                            <img class="ml-auto" style="color: #f5803e!important;"-->
<!--                                 src="{% static 'images/open-box.png' %}" width="32px" height="32px" alt="">-->

                        </div>
                        <hr class="my-1">
                        <div class="order-row">
                            <div style="display:block">
                                <small class="fs-6 text-muted text-uppercase mb-0">Today </small><br>
                                <small ><b>{{ today_product.count }}</b></small>
                            </div>
                            <div class="ml-auto">
                                <small class="fs-6 text-muted text-uppercase mb-0">Monthly </small><br>
                                <small><b>0</b></small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 mb-2">
                    <div class="box-element p-3"
                         style="background-image:url('{% static 'images/corner-2.png' %}');background-position: right; border-top-right-radius: .375rem;">
                        <h6 class="text-secondary">Total Orders</h6>
                        <div class="row ">
                            <div class="col">
                                <div class="d-flex align-items-center">
                                    <h4 class="text-truncate text-info" id="order-count" style="font-size: calc(1.2625rem + .15vw);">
                                        {{ all_order.count|intword }}
                                    </h4>
                                    <span class="badge badge-light-success mb-1 ml-2 badge-info" style="width: 45px">
                                        {{percentage}}%
                                    </span>
                                </div>
                            </div>
                            <div class="col-auto">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" height="30" width="30" class="text-info">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 19.1249H15.921C16.2753 19.125 16.6182 18.9996 16.889 18.7709C17.1597 18.5423 17.3407 18.2253 17.4 17.8759L20.037 2.37593C20.0965 2.02678 20.2776 1.70994 20.5483 1.48153C20.819 1.25311 21.1618 1.12785 21.516 1.12793H22.5"></path><path stroke="currentColor" stroke-width="1.5" d="M7.875 22.125C7.66789 22.125 7.5 21.9571 7.5 21.75C7.5 21.5429 7.66789 21.375 7.875 21.375"></path><path stroke="currentColor" stroke-width="1.5" d="M7.875 22.125C8.08211 22.125 8.25 21.9571 8.25 21.75C8.25 21.5429 8.08211 21.375 7.875 21.375"></path><path stroke="currentColor" stroke-width="1.5" d="M15.375 22.125C15.1679 22.125 15 21.9571 15 21.75C15 21.5429 15.1679 21.375 15.375 21.375"></path><path stroke="currentColor" stroke-width="1.5" d="M15.375 22.125C15.5821 22.125 15.75 21.9571 15.75 21.75C15.75 21.5429 15.5821 21.375 15.375 21.375"></path><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.9529 14.6251H5.88193C5.21301 14.625 4.5633 14.4014 4.03605 13.9897C3.5088 13.5781 3.13425 13.002 2.97193 12.3531L1.52193 6.55309C1.49426 6.44248 1.49218 6.32702 1.51583 6.21548C1.53949 6.10394 1.58827 5.99927 1.65846 5.90941C1.72864 5.81955 1.81839 5.74688 1.92089 5.69692C2.02338 5.64696 2.13591 5.62103 2.24993 5.62109H19.4839"></path>
                                </svg>
                            </div>

                        </div>
                        <hr class="my-1">
                        <div class="order-row">
                            <div style="display:block">
                                <small class="fs-6 text-muted text-uppercase mb-0">Today </small><br>
                                <small><b>{{ today_order.count }}</b></small>
                            </div>
                            <div class="ml-auto">
                                <small class="fs-6 text-muted text-uppercase mb-0">Monthly </small><br>
                                <small><b>{{ monthly_order.count }}</b></small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 mb-2">
                    <div class="box-element p-3"
                         style="background-image:url('{% static 'images/corner-1.png' %}');background-position: right; border-top-right-radius: .375rem;">
                        <h6 class="text-secondary">Total Customers</h6>
                        <div class="row">
                            <div class="col"><h4 class="text-truncate text-info"
                                style="color: #f5803e!important;font-size: calc(1.2625rem + .15vw);">{{ customers|intword }}</h4></div>
                            <div class="col-auto">
                                <svg viewBox="0 0 24 24" height="30" width="30" class="text-danger" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2.250 6.000 A2.250 2.250 0 1 0 6.750 6.000 A2.250 2.250 0 1 0 2.250 6.000 Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path>
                                    <path d="M4.5,9.75A3.75,3.75,0,0,0,.75,13.5v2.25h1.5l.75,6H6" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path>
                                    <path d="M17.250 6.000 A2.250 2.250 0 1 0 21.750 6.000 A2.250 2.250 0 1 0 17.250 6.000 Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path><path d="M19.5,9.75a3.75,3.75,0,0,1,3.75,3.75v2.25h-1.5l-.75,6H18" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path><path d="M9.000 3.750 A3.000 3.000 0 1 0 15.000 3.750 A3.000 3.000 0 1 0 9.000 3.750 Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path><path d="M17.25,13.5a5.25,5.25,0,0,0-10.5,0v2.25H9l.75,7.5h4.5l.75-7.5h2.25Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path></svg>
                            </div>
                        </div>
                        <hr class="my-1">
                        <div class="order-row">
                            <div style="display:block">
                                <small class="fs-6 text-muted text-uppercase mb-0">Today</small><br>
                                <small><b>0</b></small>
                            </div>
                            <div class="ml-auto">
                                <small class="fs-6 text-muted text-uppercase mb-0">Monthly </small><br>
                                <small><b>{{ customers|intword }}</b></small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 mb-2">
                    <div class="box-element p-3"
                         style="background-image:url('{% static 'images/corner-2.png' %}');background-position: right; border-top-right-radius: .375rem;">
                        <h6 class="text-secondary">Total Earnings</h6>
                        <div class="row ">
                            <div class="col">
                                <h4 class="text-truncate text-info" id="earnings-count" style="font-size: calc(1.2625rem + .15vw);">
                                ${{ earnings|floatformat:"2"|intcomma }}</h4>
                            </div>
                            <div class="col-auto">
<!--                                <img class="ml-auto" style="color: #f5803e!important;"-->
<!--                                 src="{% static 'images/earn.png' %}" width="32px" height="32px" alt="">-->
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="30" width="30" class="text-info"><defs><style>.a{fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round;stroke-width:1.5px;}</style></defs><title>monitor-graph-line</title><polygon class="a" points="15 23.253 9 23.253 9.75 18.753 14.25 18.753 15 23.253"></polygon><line class="a" x1="6.75" y1="23.253" x2="17.25" y2="23.253"></line><rect class="a" x="0.75" y="0.753" width="22.5" height="18" rx="3" ry="3"></rect><path class="a" d="M18.75,5.253H16.717a1.342,1.342,0,0,0-.5,2.588l2.064.825a1.342,1.342,0,0,1-.5,2.587H15.75"></path><line class="a" x1="17.25" y1="5.253" x2="17.25" y2="4.503"></line><line class="a" x1="17.25" y1="12.003" x2="17.25" y2="11.253"></line><path class="a" d="M.75,11.253,4.72,7.284a.749.749,0,0,1,1.06,0L7.72,9.223a.749.749,0,0,0,1.06,0l3.97-3.97"></path><line class="a" x1="0.75" y1="15.753" x2="23.25" y2="15.753"></line>
                                </svg>
                            </div>
                        </div>
                        <hr class="my-1">
                        <div class="order-row">
                            <div style="display:block">
                                <small class="fs-6 text-muted text-uppercase mb-0">Today</small><br>
                                <small><b>${{today_earning|floatformat:"2"|intcomma}}</b></small>
                            </div>
                            <div class="ml-auto">
                                <small class="fs-6 text-muted text-uppercase mb-0">Monthly </small><br>
                                <small><b>${{monthly_earning|floatformat:"2"|intcomma}}</b></small>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <br>
            <style>
                .order-row{
                    display: flex;
                    align-items: flex-stretch;

                }
                .chartjs-render-monitor {font-color:#fff;}

                .user-follower:hover {
                    color: #007bff !important;
                }

            </style>


            {% if request.user.vendor %}
            {% if best_selling_products|length > 0 %}

            <div class="row">
                <div class="col-lg-9">
                    <div class="card shadow" style="overflow:auto;">
                        <h5 class="p-2"><b>Best Selling Product</b></h5>
                        <table class="table table-hover">
                            <thead style="background-color: #f8f9fa;font-size: 13px">
                            <tr>
                                <th>PRODUCT</th>
                                <th>UPLOADED</th>
                                <th>PRICE</th>
                                <th>QUANTITY</th>
<!--                                <th>AMOUNT</th>-->
                            </tr>
                            </thead>
                            <tbody>

                            {% for p in best_selling_products %}
                            <tr class="p-1">
                                <td>
                                    <a class="text-dark text-decoration-none" href="{{p.get_absolute_url}}">
                                        {{ p.name }}
                                    </a>
                                </td>
                                <td>{{ p.date_posted }}</td>
                                <td>${{ p.price|floatformat:"2"|intcomma }}</td>
                                <td>{{ p.product_purchase }}</td>
<!--                                <td>${{ p.amount|floatformat:"2"|intcomma }}</td>-->
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="card shadow" style="overflow:auto;">
                        <div class="order-row">
                            <h5 class=" p-2"><b>Recent orders</b></h5>
                            <div style="flex:2">
                                <div class="mt-2 ml-2 ml-right ">
                                    <a href="#" data-target="#orderModal" data-toggle="modal">See all</a>
                                </div>
                            </div>
                        </div>
                        <table class="table table-hover">
                            <thead style="background-color: #f8f9fa;font-size: 13px">
                            <tr>
                                <th>USER</th>
                                <th>AMOUNT</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for p in orders %}
                            <tr class="p-1">
                                <td class="d-block">
                                    {{ p.user.username }}
                                    <br>
                                    <svg xmlns="http://www.w3.org/2000/svg"  width="14px" height="14px"
                                     fill="currentColor" class="bi bi-clock mr-1" viewBox="0 0 16 16">
                                    <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/></svg>
                                    {{ p.date_posted|naturalday }},
                                    {{ p.date_posted|time }}
                                </td>
                                <td>${{ p.total_order_item_price|intword|intcomma }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endif %}
            <br>
            <br>

            <script>
                var config = {
                  type: 'bar',
                  data: {
                    datasets: [{
                      data:
                      [
                      {% if request.user.vendor %}
                      {% for product in chart_products %}
                      {{product}},
                      {% endfor %}
                      {% endif %}

                    ],
                      backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)',
                        'rgba(58, 224, 25, 0.5)',
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)',
                        'rgba(58, 224, 25, 1)',
                    ],
                    borderWidth: 4,
                    color: ['#fff'],
                    pointBackgroundColor: '#00FFFF',
                    label: 'Sales',
                    }],
                    labels: {{ DOW_CHOICES|safe }},
                  },
                  options: {
                    responsive: true
                  }
                };

                window.onload = function() {
                  var ctx = document.getElementById('pie-chart').getContext('2d');
                  window.myPie = new Chart(ctx, config);
                };

            </script>
        </div>
    </div>
</div>
<div class="modal fade" id="orderModal" tabindex="-3" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable modal-dialog-centered" role="document">
        <div class="modal-content" style="background-color: #f6f9fc !important">
            <div class="modal-body">
                <h4>Order listing</h4>
                <table class="table table-hover">
                    <thead style="background-color: #f8f9fa;">
                    <tr>
                        <!--                            <th>S.N.</th>-->
                        <th>USER</th>
                        <th></th>
                        <th>ORDER ITEM</th>
                        <th>ORDERED</th>
                        <th>TOTAL</th>
                        <th>DATE POSTED</th>
                    </tr>
                    </thead>
                    <tbody>

                    {% for p in all_order %}
                    <tr>
                        <td>{{ p.user.username }}</td>
                        <td></td>
                        <td>
                            {% for i in p.order_item.all %}
                            {{ i }}<br>
                            {% endfor %}
                        </td>
                        <td>
                            {% if p.ordered %}
                            <b><span class="badge badge-success">Completed</span></b>
                            {% else %}
                            <b><span class="badge badge-warning">Order incomplete</span></b>
                            {% endif %}
                        </td>
                        <td>${{ p.total_order_item_price|intword|intcomma }}</td>
                        <td>{{ p.date_posted }}</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
  function animateValue(obj, start, end, duration) {
  let startTimestamp = null;
  const step = (timestamp) => {
    if (!startTimestamp) startTimestamp = timestamp;
    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
    obj.innerHTML = Math.floor(progress * (end - start) + start);
    if (progress < 1) {
      window.requestAnimationFrame(step);
    }
  };
  window.requestAnimationFrame(step);
}

const obj = document.getElementById("product-count");
animateValue(obj, 0, {{products.count}}, 2000);

const obj_order_count = document.getElementById("order-count");
animateValue(obj_order_count, 0, {{all_order.count}}, 2000);

//const obj_earnings_count = document.getElementById("earnings-count");
//animateValue(obj_earnings_count, 0, {{earnings}}, 2000);
</script>
{% endblock %}